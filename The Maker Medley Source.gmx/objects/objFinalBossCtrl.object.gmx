<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>sprTriggerMask</spriteName>
  <solid>0</solid>
  <visible>0</visible>
  <depth>20</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>var _transferPhaseHP = true;
image_speed = 0;
autosave = false;
roomNum = 0;
counter = 0;
//if (global.debugMode &amp;&amp; !instance_exists(objFinalBossHealthDebug)){instance_create(0, 0, objFinalBossHealthDebug);}

switch (room){
    case rFinalBoss_1:
        if (instance_exists(objPlayer)){
            instance_create(x, y, objFinalBossChar_1);
        }
        roomNum = 0;
        break;
    case rFinalBoss_2:
        if (instance_exists(objPlayer)){
            if (x &lt; 800){
                instance_create(-440, 608, objFinalKurath); //-440
                instance_create(0, 0, objFinalP2Progress);
                alarm[0] = 34;
                audio_play_sound(sndMakerExclamation, 0, 0);
                instance_create(objPlayer.x, objPlayer.y - 32, objFinalP2Exclamation);
                roomNum = 1;
            }else{
                with (objFinalYoyo){
                    with (instance_create(view_xview + 400, 256, objFinalPatCtrl)){
                        active = true;
                        timer = max(50, timer) - 0.5; //account for practice waypoint index 4
                        event_perform(ev_step, ev_step_normal);
                    }
                }
                roomNum = 2;
            }
        }else{
            show_debug_message("objPlayer not present in rFinalBoss_2!!! Can't determine exact starting position; defaulting to first save in room");
            roomNum = 1;
        }
        break;
    case rFinalBoss_3:
        alarm[0] = 8;
        roomNum = 3;
        break;
    case rFinalBoss_4:
        if (y &lt;= 0){ //Sudnep
            if (!instance_exists(objFinalSudnepCtrl)){
                with (instance_create(0, 0, objFinalSudnepCtrl)){
                    timer = startTime - 0.5;
                    timerEvent = timer;
                }
            }
            roomNum = 4;
        }else if (y &gt; 0){ //from Sudnep to P4, or straight to P4
            if (!global.dead){
                instance_create(x, -304, objFinalBossChar_4);
                if (instance_exists(objFinalSudnepCtrl)){
                    with (objFinalBossChar_4){
                        //if (!global.challengeMode){  //?????
                            autosave = true;
                        //}
                        started = false;
                    }
                    _transferPhaseHP = false;  // work around to keep BBlock Save BEFORE Ctrl Create Transfer
                }else{
                    instance_destroy(objFinalSudnepArena);
                    
                    with (objBlock){
                        if (bbox_bottom &lt; 608){
                            instance_destroy();
                        }
                    }
                    
                    scrPlayMusic(global.BGMBoss4Main4, 1); //play the music so the playIntro variable won't be reset to `true` in objWorld's End Step
                    with (objWorld){
                        playIntro = false;
                        playMusic = true;
                        musicToPlay = global.BGMBoss4Main4;
                    }
                }
            }
            roomNum = 5;
        }
        break;
}

if (!global.practicing){ //when practicing, we use a different global variable for the hp
    if (_transferPhaseHP){
        if (roomNum &gt;= 1){
            scrFinalTransferHP(roomNum, roomNum-1);
        }else{
            if (!buff()){
                global.finalBossHP[0] = global.finalBossHPMax;
            }else{
                global.finalBossBuffHP[0] = global.finalBossBuffHPMax;
            }
        }
    }
}

var _kady = 1, _yoyoPat = 3, _yoyoPat_2 = 4, _sudnep = 7;
if (!global.practicing || !((global.practiceWaypointStart == _kady &amp;&amp; room == rFinalBoss_1) || ((global.practiceWaypointStart == _yoyoPat || global.practiceWaypointStart == _yoyoPat_2) &amp;&amp; room == rFinalBoss_2) || (global.practiceWaypointStart == _sudnep &amp;&amp; room == rFinalBoss_4))){
    bar = -4;
    if (!instance_exists(objFinalBossHP) &amp;&amp; (!global.practicing || global.practiceWaypointStart &lt; 9)){
        bar = instance_create(0, 0, objFinalBossHP);
    }else{
        bar = objFinalBossHP; // so no bar?
    }
    
    with (objFinalBossHP){
        currentHPVal = other.roomNum;
    }
    show_debug_message("HP Bar loaded for phase " + string(roomNum));
}

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Prepare room for phase
if (room == rFinalBoss_2){ //Move camera
    if (counter == 0){
        with (objWorld){
            playIntro = true;
            playMusic = true;
            musicToPlay = global.BGMBoss4Main2;
        }
        with (objMakerCamera){
            xTo = -400;
            moveCam = true;
        }
        scrFinalUpdateFarthest();
        counter ++;
        alarm[0] = 40;
    }else if (counter == 1){
        counter ++;
    }
}else if (room == rFinalBoss_3){ //Preparing the room for the Undertale phase
    //this part used to play the transition animation every time P3 was started, even from the boss save
    //since the animation takes almost 3 seconds, it is no longer played from the save to prevent players from getting annoyed
    instance_create(80, -180, objFinalBossChar_3);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
