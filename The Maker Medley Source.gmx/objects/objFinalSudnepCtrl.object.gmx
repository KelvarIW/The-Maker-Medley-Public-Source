<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>sprTriggerMask</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>-1</depth>
  <persistent>0</persistent>
  <parentName>objAvoPar</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//Call parent event
event_inherited();

//Overwrite parent defaults
startTime = 116;
endTime = 693;
createIdent = false;
bgmSource = global.BGMBoss4Avo3;

usePracticeSystem = false; //this is part of a larger fight
active = true;
drawXOff = 0;
drawYOff = 0;

//Specific
createFlash = false; //only when moving from the Undertale section
sudnepAlpha = 0;
nametag = -4;
x = 400;
y = 512 - 386*0.75;
P4Block = noone;
with (objBetterBlock){
    if (image_xscale == 15){
        other.P4Block = id;
        break;
    }
}
P4BlockCounter = -1;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Create RNG Die
if (!instance_exists(objFinalRNGDie)){
    instance_create(400, -100, objFinalRNGDie);
}
with (objFinalRNGDie){
    if (y != -100){
        y = -100;
    }
    if (targetObj != other.object_index){
        targetObj = other.object_index;
        event_user(0);
    }
    appearYDiff = 100;
    shrink = false;
    grow = true;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>event_inherited();

if (timer &gt;= startTime &amp;&amp; timer &lt; 726.5){
    if (sudnepAlpha &lt; 1){
        sudnepAlpha = min(sudnepAlpha + 0.025, 1)
    }
}else if (timer &gt;= 726.5){
    if (sudnepAlpha &gt; 0){
        sudnepAlpha = max(sudnepAlpha - 0.02, 0)
    }
}

if (instance_exists(P4Block)){
    var _P4MovementFrames = 60;
    if ((P4BlockCounter &gt; 0 || (P4BlockCounter == 0 &amp;&amp; instance_exists(objPlayer) &amp;&amp; objPlayer.bbox_bottom &gt; 952)) &amp;&amp; P4BlockCounter &lt; _P4MovementFrames){
        P4BlockCounter += 1;
        if (P4BlockCounter &gt; _P4MovementFrames){
            P4BlockCounter = _P4MovementFrames;
        }
        P4Block.y = lerp(room_height + 96, P4Block.ystart, sin(P4BlockCounter/_P4MovementFrames * pi/2));
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="12">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Beginning of fight
var _inst;
_inst = instance_create(400, 64, objFinalSudnepFirstProj);
_inst.image_index = 0;
_inst.index = 0.1;
_inst = instance_create(400, 64, objFinalSudnepFirstProj);
_inst.image_index = 0;
_inst.sineAng = 180;

createIdent = true;
with (objFinalBossHP){
    currentHPVal = 4;
}
with (objTilesToSurf){
    reload = true;
}

//Nametag
nametag = scrFinalBossNametag(x, y-60, 9);
nametag.fadeInAmt =  0.025;
nametag.fadeOutAmt = 0.04;

//RNG Die
alarm[0] = 1; //Create RNG Die
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="11">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Avoidance attacks
switch(timerEvent){
    case 40:
        if (audio_is_playing(global.currentMusic)){
            global.musicFading = global.currentMusic;
            global.musFadeDec = 1/100;
            global.musicFadeEnd = "stop";
        }else{
            with (objWorld){
                musicToPlay = -1;
            }
        }
    break;
    case 78:
        instance_create(0, 0, objFinalSudnepTransition);
        createFlash = true;
        
        scrFinalUpdateFarthest();
        break;
    case 116:
        if (room != rFinalBoss_4){
            persistent = true;
            with (objFinalBossHP){
                /*
                yPosLerp = 0;
                yPos = -64;  // make hp disappear
                */
                //yPosLerp = 1; yPos = 64;
                // don't change
                persistent = true;
                roomStart = rFinalBoss_4
            }
            room_goto(rFinalBoss_4);
        }else{
            event_user(2);
        }
        break;
    case 684.5:
        if (instance_exists(nametag)){
            nametag.fadeout = true;
        }
        break;
    case 695.5:
        with (objFinalSudnepProj){
            nokill = true;
            visible = false;
        }
        with (objFinalSudnepArena){
            projSurfAlpha = 1;
        }
        if (instance_exists(nametag)){
            nametag.fadeout = true;
        }
    case 704.5:
    case 714:
    case 724.5:
        var _fade = instance_create(0, 0, objScreenFade);
        _fade.color = c_white;
        _fade.fadeIn = 0.3334;
        _fade.fadeOut = 0.1;
        _fade.alarm[0] = 4;
        break;
    case 697:
    case 706.5:
    case 716:
        view_angle[0] += 90;
        break;
    case 726.5:
        view_angle[0] = 0;
        if (global.practicing &amp;&amp; global.practiceWaypointEnd == 8){
            scrPracticeEnd();
            active = false; //stop timer
        }
        var _inst = instance_create(400, -80, objMakerSpikeUp);
        with (objFinalRNGDie){
            targetObj = _inst;
            event_user(0);
        }
        break;
    case 740:
        with (objFinalBossDraw){
            hitchBackDec = true;
        }
        with (objFinalSudnepArena){
            event_user(0);
        }
        with (objMakerCamera){
            followPlayer = true;
        }
        if (!instance_exists(objFinalBossCtrl)){
            instance_create(400, 608, objFinalBossCtrl);
        }else{
            with (objFinalBossCtrl){
                x = 400;
                y = 608;
                event_perform(ev_create, 0);
            }
        }
        with (objFinalBossHP){ currentHPVal = 4; }  // objFinalBossCtrl Create sets to 5
        P4BlockCounter = 0;
        if (instance_exists(P4Block)){
            P4Block.y = room_height + 96;
        }
        break;
}


switch(2*timerEvent + 1714){
    case 2211:
        with(objFinalSudnepFirstProj){
            if (buff() || index == 0.0){
                shrink = true;
                shrinkNum ++;
            }
            spray = false;
        }
        break;
    case 2228:
        with(objFinalSudnepFirstProj){
            if (buff() || index == 0.1){
                shrink = true;
                shrinkNum ++;
            }
        }
        break;
        break
    case 2315:
        var a;
        a = instance_create(400, 200, objFinalSudnepObject_1);
        a.indexBase = 4;
        break
    case 2335:
        var a;
        a = instance_create(400, 200, objFinalSudnepObject_1);
        a.indexBase = 0;
        break
    case 2355:
        var a;
        a = instance_create(400, 200, objFinalSudnepObject_1);
        a.indexBase = 6;
        break
    case 2407:
        var a;
        a = instance_create(400, -32, objFinalSudnepObject_2);
        a.gravity_direction = 90;
        a.gravity = 0.2;
        a.vspeed = 12;
        a.indexBase = 6;
        break
    case 2486:
        var a;
        a = instance_create(64, 640, objFinalSudnepObject_2);
        a.gravity_direction = 270;
        a.gravity = 0.2;
        a.vspeed = -12;
        a.indexBase = 2;
        a = instance_create(736, 640, objFinalSudnepObject_2);
        a.gravity_direction = 270;
        a.gravity = 0.2;
        a.vspeed = -12;
        a.indexBase = 2;
        break
    case 2562:
        var _rad = 70;
        with (objFinalSudnepObject_1){
            scrFinalSudnepStars(x, 200, _rad, 4, _rad, image_angle + 45, 10, objFinalSudnepProj, 2.0 + (number-1)/10);
        }
        with (objFinalSudnepProj)
        {
            if (floor(index) == 2)
            {
                event_user(0);
                if (index == 2.0){
                    indexBase = 0;
                    dir_inc = 1.5;
                }else if (index == 2.1){
                    indexBase = 6;
                    dir_inc = -1.5;
                }else if (index == 2.2){
                    indexBase = 2;
                    dir_inc = -1.5;
                }
            }
        }
        break
    case 2719:
        with (objFinalSudnepProj)
        {
            if (index == 2.0)
            {
                vspeed = -7;
                gravity = 0.2;
                hspeed = random_range(-0.2, 0.2);
                index = -1;
            }
        }
        with (objFinalSudnepObject_1)
        {
            if (number == 1)
            {
                vspeed = -7;
                gravity = 0.2;
                go_to_point = 0;
                alpha = 1;
                alpha_dev = -0.02;
                alpha_val = 0;
                spin_dev = 0;
            }
        }
        break
    case 2738:
        with (objFinalSudnepProj)
        {
            if (index == 2.1)
            {
                vspeed = -7;
                gravity = 0.2;
                hspeed = random_range(-0.2, 0.2);
                index = -1;
            }
        }
        with (objFinalSudnepObject_1)
        {
            if (number == 2)
            {
                vspeed = -7;
                gravity = 0.2;
                go_to_point = 0;
                alpha = 1;
                alpha_dev = -0.02;
                alpha_val = 0;
                spin_dev = 0;
            }
        }
        break
    case 2757:
        with (objFinalSudnepProj)
        {
            if (index == 2.2)
            {
                vspeed = -7;
                gravity = 0.2;
                hspeed = random_range(-0.2, 0.2);
                index = -1;
            }
        }
        with (objFinalSudnepObject_1)
        {
            if (number == 3)
            {
                vspeed = -7;
                gravity = 0.2;
                go_to_point = 0;
                alpha = 1;
                alpha_dev = -0.02;
                alpha_val = 0;
                spin_dev = 0;
            }
        }
        break
    case 2863:
        var _density;
        if (buff()){
            _density = 8;
        }else{
            _density = 5;
        }
        
        scrMakeShapes(400, 304, random(360), 6, _density, 4, objFinalSudnepProj)
        with (objFinalSudnepProj)
        {
            if (!initialized){
                index = 3.0;
                indexBase = 0;
                moveTime = ((2900 - (2*other.timerEvent + 1714)));
                radMin = 10;
                radMax = speed * moveTime;
                speed = 0;
                event_user(0);
            }
        }
        break
    case 2878:
        var _density;
        if (buff()){
            _density = 6;
        }else{
            _density = 5;
        }
        
        scrMakeShapes(400, 304, random(360), 4, _density, 6, objFinalSudnepProj)
        with (objFinalSudnepProj)
        {
            if (!initialized){
                index = 3.1;
                indexBase = 2;
                event_user(0);
            }
        }
        break
    case 2888:
        var _density;
        if (buff()){
            _density = 5;
        }else{
            _density = 4;
        }
        
        scrMakeShapes(400, 304, random(360), 5, _density, 5, objFinalSudnepProj)
        with (objFinalSudnepProj)
        {
            if (!initialized){
                index = 3.2;
                indexBase = 8;
                moveTime = ((2900 - (2*other.timerEvent + 1714)));
                radMin = 30;
                radMax = speed * moveTime;
                speed = 0;
                event_user(0);
            }
        }
        break;
    case 2925:
        
        with (objFinalSudnepProj)
        {
            if ((index == 3.0) || (index == 3.2))
            {
                if (index == 3.0){
                    radChange = 3;
                    index = 4.0
                }else{
                    radChange = 2;
                    index = 4.2
                }
                speed = 0;
                initialized = false;
                event_user(0);
            }
        }
        break;
    case 3150:
        break;
}

if (timerEvent &gt;= 608.5 &amp;&amp; timerEvent &lt; 726.5 &amp;&amp; timerEvent mod 10 == 8.5){
    with (objFinalSudnepProj){
        if (index == 4.2){
            var _inst;
            _inst = instance_create(x, y, objFinalSudnepProj);
            _inst.index = 5;
            _inst.nokill = nokill;
            _inst.visible = visible;
            _inst.direction = dir+180;
            with (_inst){
                event_user(0);
            }
        }
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="4">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if (persistent){
    if (room == rFinalBoss_4){
        event_user(2);
        if (!instance_exists(objPlayer)){
            instance_create(400, 503, objPlayer);
        }
        with (objPlayer){
            x = 400;
            y = 503;
            xprevious = x;
            yprevious = y;
        }
        
        // Autosave, add Ctrl (in that order)
        if (!buff()){
            scrTMM_Autosave(400, 464, 5);  // no autosave for buffed mode  &gt;:)
        }//
        scrFinalTransferHP(4, 3);  // transfer HP even without auto-save
        
        if (!instance_exists(objFinalBossCtrl)){
            instance_create(400, -120, objFinalBossCtrl);
        }
        
        _inst = instance_create(0, 0, objSingleJumpFlash);
        _inst.sprite_index = sprMakerDoubleStar;
        audio_play_sound(sndGainStar, 0, false);
        
        if (!instance_exists(objFinalSudnepTransition)){ //lost from room transition
            instance_create(0, 0, objFinalSudnepTransition);
        }
        with (objFinalSudnepTransition){
            image_alpha = 1;
            fade = -1;
        }
        
        //Sudnep will be fully present behind the flash
        sudnepAlpha = 1;
        if (instance_exists(nametag)){
            nametag.alphaMult = sudnepAlpha;
        }
        persistent = false;
        
        with (objMakerBossSave){
            instance_destroy();
        }
    }else{
        instance_destroy();
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>draw_sprite_ext(sprFinalSudnepMiku, global.count/5, 400+drawXOff, 512+drawYOff, 0.75, 0.75, 0, c_ltgray, sudnepAlpha);
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
